# Default values for infra-autofix-agent
# This is a YAML-formatted file.

# Global settings
global:
  namespace: infra-autofix
  imageRegistry: ghcr.io/mainulhossain123
  imagePullPolicy: IfNotPresent
  storageClass: standard

# Application configuration
app:
  enabled: true
  name: app
  image:
    repository: infra-autofix-agent-app
    tag: latest
  replicas: 2
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  service:
    type: ClusterIP
    port: 5000
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  env:
    APP_PORT: "5000"
    FLASK_ENV: "production"

# Bot configuration
bot:
  enabled: true
  name: bot
  image:
    repository: infra-autofix-agent-bot
    tag: latest
  replicas: 1
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "250m"
  service:
    type: ClusterIP
    port: 8000
  env:
    BOT_POLL_SECONDS: "5"
    CPU_THRESHOLD: "80"
    ERROR_RATE_THRESHOLD: "0.2"
    RESPONSE_TIME_THRESHOLD_MS: "500"
    MAX_RESTARTS_PER_5MIN: "3"
    COOLDOWN_SECONDS: "120"

# Frontend configuration
frontend:
  enabled: true
  name: frontend
  image:
    repository: infra-autofix-agent-frontend
    tag: latest
  replicas: 2
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"
  service:
    type: LoadBalancer
    port: 80

# PostgreSQL configuration
postgres:
  enabled: true
  name: postgres
  image:
    repository: postgres
    tag: "15-alpine"
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  persistence:
    enabled: true
    size: 10Gi
  credentials:
    user: remediation_user
    password: remediation_pass
    database: remediation_db

# Prometheus configuration
prometheus:
  enabled: true
  name: prometheus
  image:
    repository: prom/prometheus
    tag: latest
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"
  persistence:
    enabled: true
    size: 20Gi
  retention: 30d
  service:
    type: ClusterIP
    port: 9090

# Grafana configuration
grafana:
  enabled: true
  name: grafana
  image:
    repository: grafana/grafana
    tag: latest
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "250m"
  persistence:
    enabled: true
    size: 10Gi
  service:
    type: LoadBalancer
    port: 3000
  credentials:
    adminUser: admin
    adminPassword: admin

# Loki configuration
loki:
  enabled: true
  name: loki
  image:
    repository: grafana/loki
    tag: latest
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "500m"
  persistence:
    enabled: true
    size: 20Gi
  retention: 168h
  service:
    type: ClusterIP
    port: 3100

# Promtail configuration
promtail:
  enabled: true
  name: promtail
  image:
    repository: grafana/promtail
    tag: latest
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"

# Ingress configuration
ingress:
  enabled: false
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: infra-autofix.example.com
      paths:
        - path: /
          pathType: Prefix
          service: frontend
        - path: /api
          pathType: Prefix
          service: app
  tls:
    - secretName: frontend-tls
      hosts:
        - infra-autofix.example.com

# RBAC configuration
rbac:
  create: true
  serviceAccounts:
    bot:
      create: true
      name: bot-sa
    prometheus:
      create: true
      name: prometheus-sa
    promtail:
      create: true
      name: promtail-sa
